{{- if contains "Org0MSP" .Values.mspId }}
#!/bin/bash
######## post-install notes for {{ .Release.Name }}/{{ .Chart.Name }}
######## Objective: These steps create geneis.block, and secret "genesis"

########
##  NOTE: Below steps are performed only AFTER all rca0, rca1, tlsca0 and tlsca1 are Done.
######## 1. Get the name of the pod running rca:
export POD_CLI0=$(kubectl get pods -n {{ .Release.Namespace }} -l "app=orgadmin,release={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")

######## 2. Create genesis.block / channel.tx
kubectl -n {{ $.Release.Namespace }} exec -it $POD_CLI0 -- configtxgen -profile OrgsOrdererGenesis -outputBlock /var/hyperledger/crypto-config/genesis.block -channelID ordererchannel
kubectl -n {{ $.Release.Namespace }} exec -it $POD_CLI0 -- configtxgen -profile OrgsChannel -outputCreateChannelTx /var/hyperledger/crypto-config/channel.tx -channelID loanapp

######## 3. Create configmap: genesis.block
kubectl -n {{ $.Release.Namespace }} exec $POD_CLI0 -- cat ../crypto-config/genesis.block > genesis.block
kubectl -n {{ $.Release.Namespace }} create secret generic genesis --from-file=genesis=./genesis.block
rm genesis.block
# == End ==
{{- end }}
